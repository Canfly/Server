# Настройка DNS в Cloudflare для проекта CanFly

## Текущая конфигурация

Согласно нашим проверкам, домен `canfly.org` управляется через Cloudflare и имеет следующие основные записи:
- A запись для `canfly.org` указывающая на `216.24.57.1`
- MX запись указывающая на `mx.yandex.net` с приоритетом 10
- NS записи, указывающие на `leah.ns.cloudflare.com` и `phil.ns.cloudflare.com`
- CNAME запись для `www.canfly.org` указывающая на `threed-ooen.onrender.com`
- Различные TXT записи для верификации

## Необходимые изменения для новой конфигурации

### 1. Настройка основного домена

Сохраните существующую A-запись для `canfly.org` или обновите её на IP-адрес вашего нового сервера.

```
canfly.org  A  [IP-адрес вашего сервера]
```

### 2. Создание wildcard записи

Добавьте wildcard CNAME запись, которая будет перенаправлять все поддомены на основной домен:

```
*.canfly.org  CNAME  canfly.org
```

### 3. Настройка Page Rules (Правила страниц)

Создайте правило страницы, которое будет принудительно использовать HTTPS:

1. URL-шаблон: `http://*canfly.org/*`
2. Выберите действие: "Always Use HTTPS"

### 4. Настройка SSL/TLS

1. Установите режим шифрования "Full (strict)" в разделе SSL/TLS
2. Включите HSTS с подходящими настройками (если требуется)

### 5. Сохранение важных записей

Убедитесь, что следующие записи сохранены:
- MX записи для работы электронной почты
- Все TXT записи для верификации сервисов
- Специфические CNAME записи, которые могут потребоваться для работы отдельных сервисов

## Проверка настройки

После внесения изменений рекомендуется:

1. Проверить правильность разрешения доменных имен: `dig canfly.org` и `dig subdomain.canfly.org`
2. Убедиться, что Cloudflare правильно проксирует трафик (оранжевое облако в панели управления)
3. Проверить SSL-сертификаты на всех поддоменах
4. Проверить доступность основного домена и поддоменов

## Для запроса полного списка текущих DNS-записей через API

Используйте созданный Python-скрипт:

```bash
./cf-dns-export.py --token "ваш_API_токен" --domain "canfly.org" --format json > canfly-dns-records.json
```

## Дополнительные рекомендации

1. **Кэширование** - Настройте правила кэширования в Cloudflare для ускорения загрузки статического контента
2. **Firewall** - Рассмотрите настройку правил файрвола для защиты от распространенных атак
3. **Rate Limiting** - Настройте ограничение скорости запросов для защиты от DDoS-атак
4. **Workers** - Рассмотрите использование Cloudflare Workers для дополнительной логики на стороне CDN 