filebeat.inputs:
- type: filestream
  id: nginx-access
  enabled: true
  paths:
    - /var/log/nginx/access.log
  fields:
    log_type: nginx-access
  fields_under_root: true

- type: filestream
  id: nginx-error
  enabled: true
  paths:
    - /var/log/nginx/error.log
  fields:
    log_type: nginx-error
  fields_under_root: true

filebeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: false

setup.ilm.enabled: false

# Output configuration - отправка логов на внешний HTTP-сервер
output.http:
  url: "${LOG_ENDPOINT:?}"
  method: "POST"
  headers:
    "Content-Type": "application/json"
    "Authorization": "Bearer ${LOG_API_KEY:?}"
  bulk_max_size: 50
  
# Для разработки: лог в файл
# output.file:
#   path: "/tmp/filebeat"
#   filename: filebeat.log

# Настройки обработки логов
processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~
  - add_docker_metadata: ~
  - add_kubernetes_metadata: ~

# Ротация логов
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644 