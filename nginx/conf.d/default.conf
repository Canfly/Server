server {
    listen 80;
    server_name fillin.moscow *.fillin.moscow;
    
    # Корневая директория
    root /usr/share/nginx/html;
    index index.html;
    
    # Для обработки всех поддоменов
    if ($host ~* ^([^.]+)\.fillin\.moscow$) {
        return 301 https://fillin.moscow/i/$1;
    }
    
    # Правило для /i/
    location ~ ^/i/([^/]+)(/.*)? {
        add_header Content-Type text/html;
        return 200 '<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CanFly Service</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        h1 { color: #2c3e50; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .service-info { background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 20px; }
        .back-link { display: inline-block; margin-top: 20px; padding: 10px 15px; background-color: #3498db; color: white; text-decoration: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Сервис: $1</h1>
        <div class="service-info">
            <p><strong>Поддомен:</strong> $1.fillin.moscow</p>
            <p><strong>Путь запроса:</strong> $2</p>
            <p><strong>User-Agent:</strong> $http_user_agent</p>
            <p><strong>IP:</strong> $remote_addr</p>
            <p><strong>Дата и время:</strong> $time_local</p>
        </div>
        <a href="/" class="back-link">Вернуться на главную</a>
    </div>
</body>
</html>';
    }
    
    # Обработка для корневого пути
    location / {
        try_files $uri $uri/ =404;
    }
    
    # Статус сервера для проверки
    location /status {
        add_header Content-Type text/plain;
        return 200 "Server is running\nHostname: $hostname\nDate: $time_local\nDomain: fillin.moscow";
    }
} 