# Logs API Сервер

Сервер для сбора и хранения логов Nginx из вашего приложения на Railway. Позволяет собирать логи с помощью Filebeat и предоставляет API для их просмотра и анализа.

## Возможности

- Сбор логов из Nginx через Filebeat
- API для просмотра и фильтрации логов
- Структурированное хранение логов по дате и типу
- Простая настройка с помощью переменных окружения

## Начало работы

### Локальное тестирование

1. Клонируйте репозиторий
2. Перейдите в директорию с API:
   ```
   cd server-logs-api
   ```
3. Запустите с помощью Docker Compose:
   ```
   docker compose up -d
   ```
4. API будет доступен по адресу: http://localhost:5000

### Развертывание на Railway

Для развертывания на Railway:

1. Создайте новый проект в Railway
2. Свяжите его с этим репозиторием (директория server-logs-api)
3. Настройте следующие переменные окружения:
   - `API_KEY`: Секретный ключ для доступа к API
   - `LOG_STORAGE_DIR`: Путь для хранения логов (по умолчанию: `/app/logs`)
   - `PORT`: Порт для запуска сервера (по умолчанию: `5000`)

## Настройка Filebeat в основном приложении

После развертывания API логов, добавьте переменные окружения в основное приложение на Railway:

- `LOG_ENDPOINT`: URL для отправки логов (например, `https://your-logs-api.railway.app/logs`)
- `LOG_API_KEY`: Тот же ключ API, который вы настроили в Logs API

## Использование API

### Получение статуса

```
GET /health
```

### Отправка логов (от Filebeat)

```
POST /logs
Authorization: Bearer <ваш_API_ключ>
Content-Type: application/json

[
  {"log_entry": "данные_лога"}
]
```

### Просмотр списка логов

```
GET /logs/list?type=<тип_лога>&date=<дата>
Authorization: Bearer <ваш_API_ключ>
```

Параметры:
- `type`: тип лога (по умолчанию: `all`)
- `date`: дата в формате YYYY-MM-DD (по умолчанию: сегодня)

### Просмотр содержимого лога

```
GET /logs/content?type=<тип_лога>&date=<дата>&file=<имя_файла>
Authorization: Bearer <ваш_API_ключ>
```

Параметры:
- `type`: тип лога (обязательно)
- `date`: дата в формате YYYY-MM-DD (обязательно)
- `file`: имя файла лога (обязательно)

## Анализ логов

Собранные логи можно анализировать с помощью ваших ИИ-моделей, подключившись к API и выгрузив необходимые данные для обработки. 